<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Installing an OpenBSD virtual machine — Personal Notes</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css">
    <link rel="stylesheet" href="_static/pygments.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="_static/custom.css">
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="author" title="About these documents" href="about.html">
    <link rel="index" title="Index" href="genindex.html">
    <link rel="search" title="Search" href="search.html">
    <link rel="next" title="Installing a FreeBSD virtual machine" href="freebsd_vm.html">
    <link rel="prev" title="Nu HTML Checker" href="nu_html_checker.html"> 
  </head>
<body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index" accesskey="I">index</a>
</li>
        <li class="right">
          <a href="freebsd_vm.html" title="Installing a FreeBSD virtual machine" accesskey="N">next</a> |</li>
        <li class="right">
          <a href="nu_html_checker.html" title="Nu HTML Checker" accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0">
<a href="index.html">Personal Notes</a> »</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installing-an-openbsd-virtual-machine">
<h1>Installing an OpenBSD virtual machine<a class="headerlink" href="#installing-an-openbsd-virtual-machine" title="Permalink to this headline">¶</a>
</h1>
<div class="contents local topic" id="page-content">
<p class="topic-title first">Page content</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#installing-the-openbsd-signing-and-verifying-tool" id="id3">Installing the OpenBSD signing and verifying tool</a></li>
<li><a class="reference internal" href="#getting-and-verifying-the-openbsd-installer-iso-image" id="id4">Getting and verifying the OpenBSD installer ISO image</a></li>
<li>
<a class="reference internal" href="#creating-the-openbsd-virtual-machine" id="id5">Creating the OpenBSD virtual machine</a><ul>
<li><a class="reference internal" href="#start-the-installation" id="id6">Start the installation</a></li>
<li><a class="reference internal" href="#openbsd-base-installation" id="id7">OpenBSD base installation</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<span id="index-0"></span><h2>
<a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a>
</h2>
<p>These are my notes about the installation of an <a class="reference external" href="https://www.openbsd.org">OpenBSD</a> 6.6 virtual machine on my <a class="reference external" href="https://www.debian.org">Debian GNU/Linux</a> stable system (“AMD64” architecture).</p>
<p>The process is very similar to <a class="reference internal" href="debian_unstable_vm.html"><span class="doc">the installation of a Debian GNU/Linux
virtual machine</span></a> and this page does not repeat all the
details and mentions only the specific actions.</p>
<p>This page does not deal at all with the post-install configuration and usage of
the OpenBSD system.</p>
</div>
<div class="section" id="installing-the-openbsd-signing-and-verifying-tool">
<h2>
<a class="toc-backref" href="#id3">Installing the OpenBSD signing and verifying tool</a><a class="headerlink" href="#installing-the-openbsd-signing-and-verifying-tool" title="Permalink to this headline">¶</a>
</h2>
<p>On a <a class="reference external" href="https://www.debian.org">Debian GNU/Linux</a> system, you can install the
OpenBSD signing and verifying tool (<strong>as root</strong>) with:</p>
<div class="highlight-shell notranslate">
<div class="highlight"><pre><span></span>apt-get install signify-openbsd <span class="c1"># As root.</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-and-verifying-the-openbsd-installer-iso-image">
<h2>
<a class="toc-backref" href="#id4">Getting and verifying the OpenBSD installer ISO image</a><a class="headerlink" href="#getting-and-verifying-the-openbsd-installer-iso-image" title="Permalink to this headline">¶</a>
</h2>
<p id="index-2">OpenBSD installer images can be obtained from many servers. I use
<code class="docutils literal notranslate"><span class="pre">ftp.fr.openbsd.org</span></code>. I choose to download the small ISO image (cd66.iso) and
let the installer download the file sets from the Internet.</p>
<p>Here are the commands I use to download the installer image and the other files
needed for the verification:</p>
<div class="highlight-shell notranslate">
<div class="highlight"><pre><span></span>mkdir -p ~/vm/installer_iso/openbsd_6.6
<span class="nb">cd</span> ~/vm/installer_iso/openbsd_6.6
wget https://ftp.fr.openbsd.org/pub/OpenBSD/6.6/amd64/cd66.iso
wget https://ftp.fr.openbsd.org/pub/OpenBSD/6.6/amd64/SHA256
wget https://ftp.fr.openbsd.org/pub/OpenBSD/6.6/amd64/SHA256.sig
wget https://ftp.fr.openbsd.org/pub/OpenBSD/6.6/openbsd-66-base.pub
</pre></div>
</div>
<p>Then I do the verification with:</p>
<div class="highlight-shell notranslate">
<div class="highlight"><pre><span></span>signify-openbsd -C -p openbsd-66-base.pub -x SHA256.sig cd66.iso
</pre></div>
</div>
</div>
<div class="section" id="creating-the-openbsd-virtual-machine">
<h2>
<a class="toc-backref" href="#id5">Creating the OpenBSD virtual machine</a><a class="headerlink" href="#creating-the-openbsd-virtual-machine" title="Permalink to this headline">¶</a>
</h2>
<div class="section" id="start-the-installation">
<h3>
<a class="toc-backref" href="#id6">Start the installation</a><a class="headerlink" href="#start-the-installation" title="Permalink to this headline">¶</a>
</h3>
<p id="index-3">It consists in running a <code class="docutils literal notranslate"><span class="pre">virt-install</span></code> command, very much like for the
<a class="reference internal" href="debian_unstable_vm.html#start-debian-unstable-vm-install"><span class="std std-ref">Debian unstable virtual machine creation</span></a>.</p>
<p>Don’t forget to start the default virtual network and to run the needed
commands so that applications running as root can connect to the X server.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">osinfo-query</span> <span class="pre">os</span></code> to find the most appropriate value for the
<code class="docutils literal notranslate"><span class="pre">--os-variant</span></code> option (the closest value to the OS you’re installing).</p>
<p>Here is the exact <code class="docutils literal notranslate"><span class="pre">virt-install</span></code> command I use:</p>
<div class="highlight-shell notranslate">
<div class="highlight"><pre><span></span>virt-install --name openbsd_6.6 <span class="se">\</span>
  --memory <span class="m">1024</span> <span class="se">\</span>
  --vcpus<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
  --cdrom cd66.iso <span class="se">\</span>
  --disk <span class="nv">pool</span><span class="o">=</span>default,size<span class="o">=</span><span class="m">10</span> <span class="se">\</span>
  --os-variant openbsd6.3 <span class="se">\</span>
  --graphics spice <span class="se">\</span>
  --channel spicevmc <span class="p">&amp;</span> <span class="c1"># As root.</span>
</pre></div>
</div>
<p>One precision though: This doesn’t work on one of my PC (one with a AMD Phenom
II X2 555 CPU). OpenBSD fails to boot (kernel panic). The console says “Fatal
protection fault in supervisor mode”. It looks very much like the problem
discussed in this <a class="reference external" href="http://freebsd.1045724.x6.nabble.com/OpenBSD-guest-in-bhyve-on-AMD-CPU-td5987830.html">OpenBSD guest in bhyve on AMD CPU</a>
thread.</p>
<p>One solution is to expose a different CPU to the guest (using the <code class="docutils literal notranslate"><span class="pre">--cpu</span></code>
opton of <code class="docutils literal notranslate"><span class="pre">virt-install</span></code>). The output of <code class="docutils literal notranslate"><span class="pre">virsh</span> <span class="pre">domcapabilities</span></code> helped me
find possible values for the <code class="docutils literal notranslate"><span class="pre">--cpu</span></code> option. <code class="docutils literal notranslate"><span class="pre">kvm64</span></code> seems to be a working
value.</p>
<p>So on the PC with the AMD CPU, the exact <code class="docutils literal notranslate"><span class="pre">virt-install</span></code> command I use is:</p>
<div class="highlight-shell notranslate">
<div class="highlight"><pre><span></span>virt-install --name openbsd_6.6 <span class="se">\</span>
  --cpu kvm64 <span class="se">\</span>
  --memory <span class="m">1024</span> <span class="se">\</span>
  --vcpus<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
  --cdrom cd66.iso <span class="se">\</span>
  --disk <span class="nv">pool</span><span class="o">=</span>default,size<span class="o">=</span><span class="m">10</span> <span class="se">\</span>
  --os-variant openbsd6.3 <span class="se">\</span>
  --graphics spice <span class="se">\</span>
  --channel spicevmc <span class="p">&amp;</span> <span class="c1"># As root.</span>
</pre></div>
</div>
</div>
<div class="section" id="openbsd-base-installation">
<h3>
<a class="toc-backref" href="#id7">OpenBSD base installation</a><a class="headerlink" href="#openbsd-base-installation" title="Permalink to this headline">¶</a>
</h3>
<p id="index-4">Not much to say here. I didn’t have any major difficulties doing the base
installation.</p>
<p>Follow <a class="reference external" href="https://unix.stackexchange.com/questions/53238/what-does-do-you-expect-to-run-the-x-windows-system-do-when-installing-openbs">this link if you are surprised to be asked by the installer whether you
expect to run the X Window system and wants to know why</a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li>
<a class="reference internal" href="#">Installing an OpenBSD virtual machine</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installing-the-openbsd-signing-and-verifying-tool">Installing the OpenBSD signing and verifying tool</a></li>
<li><a class="reference internal" href="#getting-and-verifying-the-openbsd-installer-iso-image">Getting and verifying the OpenBSD installer ISO image</a></li>
<li>
<a class="reference internal" href="#creating-the-openbsd-virtual-machine">Creating the OpenBSD virtual machine</a><ul>
<li><a class="reference internal" href="#start-the-installation">Start the installation</a></li>
<li><a class="reference internal" href="#openbsd-base-installation">OpenBSD base installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nu_html_checker.html" title="previous chapter">Nu HTML Checker</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="freebsd_vm.html" title="next chapter">Installing a FreeBSD virtual machine</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q">
      <input type="submit" value="Go">
      <input type="hidden" name="check_keywords" value="yes">
      <input type="hidden" name="area" value="default">
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index">index</a>
</li>
        <li class="right">
          <a href="freebsd_vm.html" title="Installing a FreeBSD virtual machine">next</a> |</li>
        <li class="right">
          <a href="nu_html_checker.html" title="Nu HTML Checker">previous</a> |</li>
        <li class="nav-item nav-item-0">
<a href="index.html">Personal Notes</a> »</li> 
      </ul>
    </div>
  <div class="footer" role="contentinfo">
        © Copyright 2018-2019, <a class="reference internal" href="about.html"><span class="doc">Thierry Rascle</span></a>.<br>
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png"></a>
    Work licensed under a
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.<br>
      <div class="generator_mention">Static website built using <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://nokogiri.org/">Nokogiri</a>. Validated <a href="https://validator.w3.org/check?uri=referer">HTML5</a> / <a href="https://jigsaw.w3.org/css-validator/check/referer">CSS3</a>.</div>
    <a href="mailto:thierr26@free.fr">Feedback welcome</a>.
  </div>

  </body>
</html>
